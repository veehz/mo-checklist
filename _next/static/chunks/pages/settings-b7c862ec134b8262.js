(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[199],{7282:(e,s,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings",function(){return a(5020)}])},5020:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>h});var r=a(4848),t=a(8358),o=a(6128);a(1106);var n=a(6540),l=a(9640),i=a(6271),d=a(9785),c=a(361),m=a(6715),u=a(9141);function h(){var e,s,a,h,x,g;let p=(0,m.useRouter)(),[w,f]=(0,n.useState)(null),[v,y]=(0,n.useState)(null),[j,N]=(0,n.useState)({}),{register:b,formState:{errors:P},handleSubmit:C,setValue:S}=(0,d.mN)({defaultValues:{competitions:o.A.map(e=>e.shortname)}}),Y=async e=>{try{await (0,l.r7)(i.j.currentUser,{displayName:e.name});let s={};for(let a of(s["profile/".concat(i.j.currentUser.uid,"/displayName")]=e.name,void 0===e.shownYears||Number.isNaN(e.shownYears)?s["profile/".concat(i.j.currentUser.uid,"/shownYears")]=null:s["profile/".concat(i.j.currentUser.uid,"/shownYears")]=e.shownYears,o.A))e.competitions.includes(a.shortname)?(!j.hiddenContests||j.hiddenContests[a.shortname])&&(s["profile/".concat(i.j.currentUser.uid,"/hiddenContests/").concat(a.shortname)]=null):j.hiddenContests&&j.hiddenContests[a.shortname]||(s["profile/".concat(i.j.currentUser.uid,"/hiddenContests/").concat(a.shortname)]=!0);await (0,u.yo)((0,u.KR)(i.db),s),p.reload()}catch(e){console.log(e),y("An error occurred. Please try again.")}};(0,n.useEffect)(()=>{(0,l.hg)(i.j,e=>{e&&(console.log("run"),f(e),S("name",e.displayName||""),(0,u.Zy)((0,u.KR)(i.db,"profile/"+e.uid),e=>{if(N(e.val()||{}),e.exists()&&(null!==e.val().shownYears&&S("shownYears",e.val().shownYears),e.val().hiddenContests)){let s=[];for(let a of o.A)e.val().hiddenContests[a.shortname]||s.push(a.shortname);S("competitions",s)}},{onlyOnce:!0}))})},[S]);let[_,A]=(0,n.useState)(null),{register:k,formState:{errors:q},handleSubmit:U,setValue:E}=(0,d.mN)();return(0,r.jsxs)("main",{children:[(0,r.jsx)(t.A,{title:"Settings"}),(0,r.jsx)("div",{className:"py-4 px-12",children:(0,r.jsx)("h1",{className:"font-bold text-3xl text-center",children:"Settings"})}),w?(0,r.jsxs)("div",{className:"pb-4 pt-2 px-12",children:[v?(0,r.jsx)("div",{className:"pb-4 text-center",children:v}):null,(0,r.jsx)("h2",{className:"font-bold text-2xl text-center",children:"Profile"}),(0,r.jsx)("div",{className:"text-sm",children:(null==P?void 0:null===(e=P.name)||void 0===e?void 0:e.message)||(null==P?void 0:null===(s=P.shownYears)||void 0===s?void 0:s.message)||(null==P?void 0:null===(a=P.competitions)||void 0===a?void 0:a.message)}),(0,r.jsx)("div",{className:"space-y-2 max-w-md mx-auto",children:(0,r.jsxs)("form",{className:"mx-auto my-4",onSubmit:C(Y),children:[(0,r.jsx)("h3",{className:"font-bold text-xl text-center mt-4 mb-2",children:"Display Name"}),(0,r.jsx)("input",{...b("name"),id:"name",type:"text",className:"rounded-md relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Name"}),(0,r.jsxs)("h3",{className:"font-bold text-xl text-center mt-4 mb-2",children:["Shown Years",(0,r.jsxs)("div",{className:"text-sm",children:["(Competitions before or during (",new Date().getFullYear()," - shownYears) will not be shown)"]})]}),(0,r.jsx)("input",{...b("shownYears",{valueAsNumber:!0,min:{value:0,message:"Shown Years must be at least 0"}}),id:"shownYears",type:"number",className:"rounded-md relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Shown Years (Default = ".concat("15",")")}),(0,r.jsx)("h3",{className:"font-bold text-xl text-center mt-4 mb-2",children:"My Competitions"}),o.A.map(e=>(0,r.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,r.jsx)("input",{type:"checkbox",id:e.shortname.toLowerCase(),...b("competitions"),value:e.shortname},e.name),(0,r.jsx)("label",{htmlFor:e.shortname.toLowerCase(),children:e.name})]},e.shortname)),(0,r.jsx)(c.A,{className:"mt-2",props:{type:"submit"},full:!0,children:"Save"})]})}),(0,r.jsx)("h2",{className:"font-bold text-2xl text-center",children:"Set a New Password"}),(0,r.jsx)("div",{className:"space-y-2 max-w-md mx-auto",children:(0,r.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:U(e=>{(0,l.x9)(i.j,w.email,e.oldPassword).then(()=>{(0,l.f3)(i.j.currentUser,e.newPassword).then(()=>{p.reload()}).catch(e=>{console.log(e),A("An error occurred. Please try again.")})}).catch(e=>{console.log(e),A("An error occurred. Please try again.")})}),noValidate:!0,children:[(0,r.jsxs)("div",{className:"-space-y-px rounded-md shadow-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"oldPassword",className:"sr-only",children:"Old Password"}),(0,r.jsx)("input",{...k("oldPassword",{minLength:{value:8,message:"Password must have at least 8 characters."},maxLength:{value:20,message:"Password must have less than 20 characters."},required:"Password is required."}),id:"oldPassword",type:"password",autoComplete:"password",required:!0,className:"rounded-t-md relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Old Password"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"newpassword",className:"sr-only",children:"Password"}),(0,r.jsx)("input",{...k("newPassword",{minLength:{value:8,message:"Password must have at least 8 characters."},maxLength:{value:20,message:"Password must have less than 20 characters."},required:"Password is required."}),id:"newpassword",type:"password",autoComplete:"password",required:!0,className:"relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"New Password"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"confirmPassword",className:"sr-only",children:"Confirm Password"}),(0,r.jsx)("input",{...k("confirmPassword",{validate:{validateSamePassword:(e,s)=>e===s.newPassword||"Passwords do not match."}}),id:"confirmPassword",type:"password",autoComplete:"password",required:!0,className:"rounded-b-md relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Confirm Password"})]})]}),(0,r.jsx)("div",{className:"text-red-500",children:(0,r.jsx)("div",{children:(null==q?void 0:null===(h=q.oldPassword)||void 0===h?void 0:h.message)||(null==q?void 0:null===(x=q.newPassword)||void 0===x?void 0:x.message)||(null==q?void 0:null===(g=q.confirmPassword)||void 0===g?void 0:g.message)||_})}),(0,r.jsx)("div",{children:(0,r.jsx)(c.A,{className:"mt-2",props:{type:"submit"},full:!0,children:"Change Password"})})]})})]}):(0,r.jsx)("div",{className:"m-2 text-center",children:"You must be logged in to view this page."})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[505,490,564,785,633,636,593,792],()=>s(7282)),_N_E=e.O()}]);