(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{2837:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings",function(){return a(7702)}])},7702:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return h}});var r=a(5893),t=a(3425),o=a(8965);a(1664);var n=a(7294),l=a(1259),i=a(1481),d=a(7536),c=a(3067),m=a(1163),u=a(1019);function h(){var e,s,a;let h=(0,m.useRouter)(),[x,p]=(0,n.useState)(null),[g,w]=(0,n.useState)(!1),[f,v]=(0,n.useState)({}),{register:y,formState:{errors:N},handleSubmit:j,setValue:P}=(0,d.cI)({defaultValues:{competitions:o.Z.map(e=>e.shortname)}}),b=async e=>{try{await (0,l.ck)(i.I.currentUser,{displayName:e.name});let s={};for(let a of(s["profile/".concat(i.I.currentUser.uid,"/displayName")]=e.name,o.Z))e.competitions.includes(a.shortname)?f[a.shortname]&&(s["profile/".concat(i.I.currentUser.uid,"/hiddenContests/").concat(a.shortname)]=null):f[a.shortname]||(s["profile/".concat(i.I.currentUser.uid,"/hiddenContests/").concat(a.shortname)]=!0);await (0,u.Vx)((0,u.iH)(i.db),s)}catch(e){console.log(e)}h.reload()};(0,n.useEffect)(()=>{(0,l.Aj)(i.I,e=>{e&&(console.log("run"),p(e),P("name",e.displayName||""),(0,u.jM)((0,u.iH)(i.db,"profile/"+e.uid+"/hiddenContests"),e=>{if(!e.exists())return;v(e.val()||{});let s=[];for(let a of o.Z)e.val()[a.shortname]||s.push(a.shortname);P("competitions",s)},{onlyOnce:!0}))})},[P]);let[C,S]=(0,n.useState)(null),{register:_,formState:{errors:k},handleSubmit:I,setValue:q}=(0,d.cI)(),Z=e=>{(0,l.e5)(i.I,x.email,e.oldPassword).then(()=>{(0,l.gQ)(i.I.currentUser,e.newPassword).then(()=>{h.reload()}).catch(e=>{console.log(e),S("An error occurred. Please try again.")})}).catch(e=>{console.log(e),S("An error occurred. Please try again.")})};return(0,r.jsxs)("main",{children:[(0,r.jsx)(t.Z,{title:"Settings"}),(0,r.jsx)("div",{className:"py-4 px-12",children:(0,r.jsx)("h1",{className:"font-bold text-3xl text-center",children:"Settings"})}),x?(0,r.jsxs)("div",{className:"py-4 px-12",children:[(0,r.jsx)("h2",{className:"font-bold text-2xl text-center",children:"Profile"}),(0,r.jsx)("div",{className:"space-y-2 max-w-md mx-auto",children:(0,r.jsxs)("form",{className:"mx-auto my-4",onSubmit:j(b),children:[(0,r.jsx)("h3",{className:"font-bold text-xl text-center mt-4 mb-2",children:"Display Name"}),(0,r.jsx)("input",{...y("name"),id:"name",type:"text",className:"rounded-md relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Name"}),(0,r.jsx)("h3",{className:"font-bold text-xl text-center mt-4 mb-2",children:"My Competitions"}),o.Z.map(e=>(0,r.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,r.jsx)("input",{type:"checkbox",id:e.shortname.toLowerCase(),...y("competitions"),value:e.shortname},e.name),(0,r.jsx)("label",{htmlFor:e.shortname.toLowerCase(),children:e.name})]},e.shortname)),(0,r.jsx)(c.Z,{className:"mt-2",props:{type:"submit"},full:!0,children:"Save"})]})}),(0,r.jsx)("h2",{className:"font-bold text-2xl text-center",children:"Set a New Password"}),(0,r.jsx)("div",{className:"space-y-2 max-w-md mx-auto",children:(0,r.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:I(Z),noValidate:!0,children:[(0,r.jsxs)("div",{className:"-space-y-px rounded-md shadow-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"oldPassword",className:"sr-only",children:"Old Password"}),(0,r.jsx)("input",{..._("oldPassword",{minLength:{value:8,message:"Password must have at least 8 characters."},maxLength:{value:20,message:"Password must have less than 20 characters."},required:"Password is required."}),id:"oldPassword",type:"password",autoComplete:"password",required:!0,className:"rounded-t-md relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Old Password"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"newpassword",className:"sr-only",children:"Password"}),(0,r.jsx)("input",{..._("newPassword",{minLength:{value:8,message:"Password must have at least 8 characters."},maxLength:{value:20,message:"Password must have less than 20 characters."},required:"Password is required."}),id:"newpassword",type:"password",autoComplete:"password",required:!0,className:"relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"New Password"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"confirmPassword",className:"sr-only",children:"Confirm Password"}),(0,r.jsx)("input",{..._("confirmPassword",{validate:{validateSamePassword:(e,s)=>e===s.newPassword||"Passwords do not match."}}),id:"confirmPassword",type:"password",autoComplete:"password",required:!0,className:"rounded-b-md relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Confirm Password"})]})]}),(0,r.jsx)("div",{className:"text-red-500",children:(0,r.jsx)("div",{children:(null==k?void 0:null===(e=k.oldPassword)||void 0===e?void 0:e.message)||(null==k?void 0:null===(s=k.newPassword)||void 0===s?void 0:s.message)||(null==k?void 0:null===(a=k.confirmPassword)||void 0===a?void 0:a.message)||C})}),(0,r.jsx)("div",{children:(0,r.jsx)(c.Z,{className:"mt-2",props:{type:"submit"},full:!0,children:"Change Password"})})]})})]}):(0,r.jsx)("div",{className:"m-2 text-center",children:"You must be logged in to view this page."})]})}}},function(e){e.O(0,[627,70,462,536,802,774,888,179],function(){return e(e.s=2837)}),_N_E=e.O()}]);