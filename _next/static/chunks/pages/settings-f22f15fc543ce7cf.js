(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{2837:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings",function(){return a(1453)}])},1453:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return h}});var r=a(5893),t=a(9358),n=a(9438);a(1664);var o=a(7294),l=a(1259),i=a(8209),d=a(7536),c=a(9883),m=a(1163),u=a(1019);function h(){var e,s,a,h,x,g;let p=(0,m.useRouter)(),[w,f]=(0,o.useState)(null),[v,y]=(0,o.useState)(null),[N,b]=(0,o.useState)({}),{register:j,formState:{errors:P},handleSubmit:C,setValue:S}=(0,d.cI)({defaultValues:{competitions:n.Z.map(e=>e.shortname)}}),Y=async e=>{try{await (0,l.ck)(i.I.currentUser,{displayName:e.name});let s={};for(let a of(s["profile/".concat(i.I.currentUser.uid,"/displayName")]=e.name,void 0===e.shownYears||Number.isNaN(e.shownYears)?s["profile/".concat(i.I.currentUser.uid,"/shownYears")]=null:s["profile/".concat(i.I.currentUser.uid,"/shownYears")]=e.shownYears,n.Z))e.competitions.includes(a.shortname)?(!N.hiddenContests||N.hiddenContests[a.shortname])&&(s["profile/".concat(i.I.currentUser.uid,"/hiddenContests/").concat(a.shortname)]=null):N.hiddenContests&&N.hiddenContests[a.shortname]||(s["profile/".concat(i.I.currentUser.uid,"/hiddenContests/").concat(a.shortname)]=!0);await (0,u.Vx)((0,u.iH)(i.db),s),p.reload()}catch(e){console.log(e),y("An error occurred. Please try again.")}};(0,o.useEffect)(()=>{(0,l.Aj)(i.I,e=>{e&&(console.log("run"),f(e),S("name",e.displayName||""),(0,u.jM)((0,u.iH)(i.db,"profile/"+e.uid),e=>{if(b(e.val()||{}),e.exists()&&(null!==e.val().shownYears&&S("shownYears",e.val().shownYears),e.val().hiddenContests)){let s=[];for(let a of n.Z)e.val().hiddenContests[a.shortname]||s.push(a.shortname);S("competitions",s)}},{onlyOnce:!0}))})},[S]);let[_,k]=(0,o.useState)(null),{register:I,formState:{errors:q},handleSubmit:U,setValue:Z}=(0,d.cI)();return(0,r.jsxs)("main",{children:[(0,r.jsx)(t.Z,{title:"Settings"}),(0,r.jsx)("div",{className:"py-4 px-12",children:(0,r.jsx)("h1",{className:"font-bold text-3xl text-center",children:"Settings"})}),w?(0,r.jsxs)("div",{className:"pb-4 pt-2 px-12",children:[v?(0,r.jsx)("div",{className:"pb-4 text-center",children:v}):null,(0,r.jsx)("h2",{className:"font-bold text-2xl text-center",children:"Profile"}),(0,r.jsx)("div",{className:"text-sm",children:(null==P?void 0:null===(e=P.name)||void 0===e?void 0:e.message)||(null==P?void 0:null===(s=P.shownYears)||void 0===s?void 0:s.message)||(null==P?void 0:null===(a=P.competitions)||void 0===a?void 0:a.message)}),(0,r.jsx)("div",{className:"space-y-2 max-w-md mx-auto",children:(0,r.jsxs)("form",{className:"mx-auto my-4",onSubmit:C(Y),children:[(0,r.jsx)("h3",{className:"font-bold text-xl text-center mt-4 mb-2",children:"Display Name"}),(0,r.jsx)("input",{...j("name"),id:"name",type:"text",className:"rounded-md relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Name"}),(0,r.jsxs)("h3",{className:"font-bold text-xl text-center mt-4 mb-2",children:["Shown Years",(0,r.jsxs)("div",{className:"text-sm",children:["(Competitions before or during (",new Date().getFullYear()," - shownYears) will not be shown)"]})]}),(0,r.jsx)("input",{...j("shownYears",{valueAsNumber:!0,min:{value:0,message:"Shown Years must be at least 0"}}),id:"shownYears",type:"number",className:"rounded-md relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Shown Years (Default = ".concat("15",")")}),(0,r.jsx)("h3",{className:"font-bold text-xl text-center mt-4 mb-2",children:"My Competitions"}),n.Z.map(e=>(0,r.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,r.jsx)("input",{type:"checkbox",id:e.shortname.toLowerCase(),...j("competitions"),value:e.shortname},e.name),(0,r.jsx)("label",{htmlFor:e.shortname.toLowerCase(),children:e.name})]},e.shortname)),(0,r.jsx)(c.Z,{className:"mt-2",props:{type:"submit"},full:!0,children:"Save"})]})}),(0,r.jsx)("h2",{className:"font-bold text-2xl text-center",children:"Set a New Password"}),(0,r.jsx)("div",{className:"space-y-2 max-w-md mx-auto",children:(0,r.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:U(e=>{(0,l.e5)(i.I,w.email,e.oldPassword).then(()=>{(0,l.gQ)(i.I.currentUser,e.newPassword).then(()=>{p.reload()}).catch(e=>{console.log(e),k("An error occurred. Please try again.")})}).catch(e=>{console.log(e),k("An error occurred. Please try again.")})}),noValidate:!0,children:[(0,r.jsxs)("div",{className:"-space-y-px rounded-md shadow-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"oldPassword",className:"sr-only",children:"Old Password"}),(0,r.jsx)("input",{...I("oldPassword",{minLength:{value:8,message:"Password must have at least 8 characters."},maxLength:{value:20,message:"Password must have less than 20 characters."},required:"Password is required."}),id:"oldPassword",type:"password",autoComplete:"password",required:!0,className:"rounded-t-md relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Old Password"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"newpassword",className:"sr-only",children:"Password"}),(0,r.jsx)("input",{...I("newPassword",{minLength:{value:8,message:"Password must have at least 8 characters."},maxLength:{value:20,message:"Password must have less than 20 characters."},required:"Password is required."}),id:"newpassword",type:"password",autoComplete:"password",required:!0,className:"relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"New Password"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"confirmPassword",className:"sr-only",children:"Confirm Password"}),(0,r.jsx)("input",{...I("confirmPassword",{validate:{validateSamePassword:(e,s)=>e===s.newPassword||"Passwords do not match."}}),id:"confirmPassword",type:"password",autoComplete:"password",required:!0,className:"rounded-b-md relative block w-full border-0 px-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Confirm Password"})]})]}),(0,r.jsx)("div",{className:"text-red-500",children:(0,r.jsx)("div",{children:(null==q?void 0:null===(h=q.oldPassword)||void 0===h?void 0:h.message)||(null==q?void 0:null===(x=q.newPassword)||void 0===x?void 0:x.message)||(null==q?void 0:null===(g=q.confirmPassword)||void 0===g?void 0:g.message)||_})}),(0,r.jsx)("div",{children:(0,r.jsx)(c.Z,{className:"mt-2",props:{type:"submit"},full:!0,children:"Change Password"})})]})})]}):(0,r.jsx)("div",{className:"m-2 text-center",children:"You must be logged in to view this page."})]})}}},function(e){e.O(0,[627,96,918,536,224,774,888,179],function(){return e(e.s=2837)}),_N_E=e.O()}]);